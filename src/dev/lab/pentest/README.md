# Northwind lab

## Scripts

Start:

```sh
./start.sh
```

End:

```sh
./end.sh
```

## Lab

Execute query for cli

```sh
# verify
lambdaorm execute -w ./workspace -e .env -q 'Products.having(p => max(p.price) > 100).map(p => ({ category: p.category.name, largestPrice: max(p.price) })).sort(p => desc(p.largestPrice))'

lambdaorm execute -w ./workspace -e .env -q 'Orders.filter(p => p.id === id).include(p => [p.customer.map(p => p.name), p.details.include(p => p.product.include(p => p.category.map(p => p.name)).map(p => p.name)).map(p => [p.quantity, p.unitPrice])])' -d '{"id": 2 }'
```

## Endpoints

- [swagger](http://localhost:9292/api-docs)
- [metrics](http://localhost:9292/metrics)
- [Prometheus](http://localhost:9090)
- [Grafana](http://localhost:3000)
  - [nodejs](http://localhost:3000/d/PTSqcpJWk/nodejs-application-dashboard?orgId=1&refresh=10s)
- Dashboards
  - [NodeJS Application Dashboard](http://localhost:3000/d/PTSqcpJWk/nodejs-application-dashboard)
  - [High Level Application metrics](http://localhost:3000/d/OnjTYJg7k/high-level-application-metrics)
  - [Node Service Level Metrics Dashboard](http://localhost:3000/d/WBxkVyRnz/node-service-level-metrics-dashboard)
  - [NodeJS Request Flow Dashboard](http://localhost:3000/d/2Er5E1R7k/nodejs-request-flow-dashboard)

## DDOS tools

- Slowloris
  - [Install and use tutorial](https://www.youtube.com/watch?v=EccCgGuUJaA)
  - [Prueba de concepto](https://www.youtube.com/watch?v=dbOfYzcijFw)
  - [Ataque DDoS con Slowloris](https://www.youtube.com/watch?v=G_RPCkWE5jE)

## TODO

- resolver el problema de conexión a la base desde otro servicio en el mismo docker file
- agregar nginx y escalar el servicio (tag deploy)
- agregar aquí el laboratorio de pentest

## References

- [network host](https://stackoverflow.com/questions/56582446/how-to-use-host-network-for-docker-compose)
- connection refused
  - [one](https://nayak.io/posts/docker-compose-postgres-and-connection-refused/)
  - [two](https://www.appsloveworld.com/docker/100/2/econnrefused-for-postgres-on-nodejs-with-dockers)
